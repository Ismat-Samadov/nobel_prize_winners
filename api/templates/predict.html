{% extends "base.html" %}

{% block title %}Predict - Active Learning NER{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-search me-2"></i>Named Entity Recognition Prediction</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">Enter text below to identify named entities such as persons, organizations, locations, and more.</p>
                
                <!-- Prediction Form -->
                <form method="post">
                    <div class="mb-3">
                        <label for="text" class="form-label">Input Text</label>
                        <textarea class="form-control" id="text" name="text" rows="4" 
                                placeholder="Enter your text here for named entity recognition..." required>{{ text or '' }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>Analyze Text
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="clearText()">
                        <i class="fas fa-eraser me-2"></i>Clear
                    </button>
                </form>

                <!-- Error Display -->
                {% if error %}
                <div class="alert alert-danger mt-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
                </div>
                {% endif %}

                <!-- Results -->
                {% if prediction_made %}
                <div class="mt-4">
                    <h6>Annotated Text:</h6>
                    <div class="border p-3 bg-light rounded prediction-result">
                        {% for token in tokens %}
                            {% if token.label %}
                                <span class="entity-highlight entity-{{ token.label.replace('PERSON', 'PER').replace('ORGANIZATION', 'ORG').replace('LOCATION', 'LOC') }}" 
                                      title="{{ token.label }} ({{ token.confidence }})">{{ token.text }}</span>
                            {% else %}
                                <span>{{ token.text }}</span>
                            {% endif %}
                            {% if not loop.last %} {% endif %}
                        {% endfor %}
                    </div>

                    {% if entities %}
                    <div class="mt-3">
                        <h6>Detected Entities:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for entity in entities %}
                            <span class="badge entity-highlight entity-{{ entity.label.replace('PERSON', 'PER').replace('ORGANIZATION', 'ORG').replace('LOCATION', 'LOC') }}" 
                                  style="font-size: 0.9em;">
                                {{ entity.text }} ({{ entity.label }}, {{ entity.confidence }})
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Sample Texts -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Sample Texts</h6>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">Try these examples to see how the NER model works:</p>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="sample-text" onclick="setSampleText('John Smith works at Google in Mountain View, California.')">
                            "John Smith works at Google in Mountain View, California."
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="sample-text" onclick="setSampleText('Apple Inc. was founded by Steve Jobs in Cupertino.')">
                            "Apple Inc. was founded by Steve Jobs in Cupertino."
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="sample-text" onclick="setSampleText('The meeting will be held at Stanford University next week.')">
                            "The meeting will be held at Stanford University next week."
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="sample-text" onclick="setSampleText('Microsoft announced a new partnership with OpenAI.')">
                            "Microsoft announced a new partnership with OpenAI."
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Entity Legend -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-tags me-2"></i>Entity Types</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-6 col-md-3 mb-2">
                        <span class="entity-highlight entity-PER">PERSON</span>
                        <small class="text-muted ms-2">Person names</small>
                    </div>
                    <div class="col-sm-6 col-md-3 mb-2">
                        <span class="entity-highlight entity-ORG">ORGANIZATION</span>
                        <small class="text-muted ms-2">Organizations</small>
                    </div>
                    <div class="col-sm-6 col-md-3 mb-2">
                        <span class="entity-highlight entity-LOC">LOCATION</span>
                        <small class="text-muted ms-2">Locations</small>
                    </div>
                    <div class="col-sm-6 col-md-3 mb-2">
                        <span class="entity-highlight entity-MISC">MISC</span>
                        <small class="text-muted ms-2">Miscellaneous</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function setSampleText(text) {
    document.getElementById('text').value = text;
}

function clearText() {
    document.getElementById('text').value = '';
}
</script>
{% endblock %}